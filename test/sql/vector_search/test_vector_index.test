# name: test/sql/vector_search/test_vector_index.test
# description: Test vector_search
# group: [vector_search]

statement ok
PRAGMA enable_verification

statement ok
create table list_table(embedding FLOAT[], id INTEGER, c INTEGER);

require json

statement ok
copy list_table from 'test/sql/vector_search/embedding.json';

statement ok
CREATE INDEX idx_v ON list_table USING ivfflat(embedding vector_ip_ops) WITH (oplists = 1, d = 3);

statement ok
select id, embedding, list_distance(embedding, [2.0, 1.2, 2.0]) as score from list_table order by score desc limit 3;

query I
select id, list_distance(embedding, [2.0, 1.2, 2.0]) as score from list_table where id < 3;
----
1
2
3

query I
select id, embedding, list_distance(embedding, [2.0, 1.2, 2.0]) as score from list_table where id < 10 order by score desc limit 3;
